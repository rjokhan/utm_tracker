{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard ‚Äî Qizil pomada</title>

  <!-- CSS -->
  <link rel="stylesheet" href="{% static 'css/index.css' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Mobile rail + burger -->
<div class="m-rail" id="mRail">
  <button class="m-burger" id="mBurger" aria-label="Open menu">
    <img src="{% static 'img/burger_menu.png' %}" alt="">
  </button>
</div>

<!-- Backdrop (blur) -->
<div class="m-backdrop" id="mBackdrop"></div>


  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <a href="{% url 'index' %}">
        <img src="{% static 'img/brand-logo.png' %}" alt="Qizil pomada">
      </a>
    </div>

    <nav class="nav">
      <a class="nav-item active" href="{% url 'index' %}">
        <img src="{% static 'img/ic-dashboard.png' %}" alt="">
        <span>Dashboard</span>
      </a>
      <a class="nav-item" href="{% url 'projects' %}">
        <img src="{% static 'img/ic-projects.png' %}" alt="">
        <span>All projects</span>
      </a>
      <a class="nav-item" href="{% url 'members' %}">
        <img src="{% static 'img/ic-team.png' %}" alt="">
        <span>Team members</span>
      </a>
    </nav>

    <div class="powered">
      <div class="powered-text">Designed &amp; powered by</div>
      <img class="powered-logo" src="{% static 'img/joan-logo.png' %}" alt="JOAN">
    </div>
  </aside>

  <!-- Content -->
  <main class="content">
    <header class="header">
      <div>
        <h1 class="title">Dashboard</h1>
        <div class="status">Role: <b>Editor</b></div>
      </div>
    </header>

    <!-- Overview -->
<section class="section">
  <h3 class="section-title">Overview</h3>
  <div class="kpi-row">
    <div class="kpi kpi-pink">
      <div class="kpi-icon"><img src="{% static 'img/ic-chart.png' %}" alt=""></div>
      <div class="kpi-main">
        <div class="kpi-num" id="kpi-projects"></div>
        <div class="kpi-sub">total number of projects</div>
      </div>
    </div>

    <div class="kpi kpi-blue">
      <div class="kpi-icon"><img src="{% static 'img/ic-chart.png' %}" alt=""></div>
      <div class="kpi-main">
        <div class="kpi-num" id="kpi-links"></div>
        <div class="kpi-sub">total number of links</div>
      </div>
    </div>

    <!-- üëá –ù–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="kpi kpi-violet">
      <div class="kpi-icon"><img src="{% static 'img/ic-chart.png' %}" alt=""></div>
      <div class="kpi-main">
        <div class="kpi-num" id="kpi-uniques"></div>
        <div class="kpi-sub">unique users (all links)</div>
      </div>
    </div>

    <div class="kpi kpi-green kpi-wide">
      <div class="kpi-icon"><img src="{% static 'img/ic-chart.png' %}" alt=""></div>
      <div class="kpi-main">
        <div class="kpi-num big" id="kpi-clicks"></div>
        <div class="kpi-sub">total number of clicks</div>
      </div>
    </div>
  </div>
</section>

  </main>

    <!-- JS -->
  <script src="{% static 'js/api.js' %}"></script>
  <script src="{% static 'js/index.js' %}"></script>

  <!-- === Qizil Pomada tracker: persistent user key + auto attach === -->
  <script>
  // === –®–ê–ì 1. –°–æ–∑–¥–∞—ë–º –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π user_key –≤ localStorage ===
  (function () {
    try {
      let key = localStorage.getItem('qp_user_key');
      if (!key) {
        key = (crypto && crypto.randomUUID)
          ? crypto.randomUUID()
          : Math.random().toString(36).slice(2) + Date.now().toString(36);
        localStorage.setItem('qp_user_key', key);
      }
      window.QP_USER_KEY = key;
    } catch (e) {
      window.QP_USER_KEY = 'fallback-' + Date.now();
    }
  })();

  // === –®–ê–ì 2. –î–æ–±–∞–≤–ª—è–µ–º user=<QP_USER_KEY> –∫–æ –≤—Å–µ–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º —Ç—Ä–µ–∫-—Å—Å—ã–ª–∫–∞–º ===
  document.addEventListener('click', function(e) {
    const a = e.target.closest('a[href*="/api/track-click/"]');
    if (!a) return;
    const url = new URL(a.href, location.origin);
    url.searchParams.set('user', window.QP_USER_KEY);
    a.href = url.toString();
  }, true);
  </script>


<script>
  (function(){
    const body = document.body;
    const burger = document.getElementById('mBurger');
    const backdrop = document.getElementById('mBackdrop');
    const sidebar = document.querySelector('.sidebar');

    function openNav(){ body.classList.add('mnav-open'); }
    function closeNav(){ body.classList.remove('mnav-open'); }
    function toggleNav(){ body.classList.toggle('mnav-open'); }

    burger?.addEventListener('click', toggleNav);
    backdrop?.addEventListener('click', closeNav);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') closeNav();
    });

    // –ö–ª–∏–∫ –ø–æ –ø—É–Ω–∫—Ç–∞–º –º–µ–Ω—é –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥—Ä–æ–≤–µ—Ä
    sidebar?.addEventListener('click', (e)=>{
      const a = e.target.closest('a');
      if(a) closeNav();
    });
  })();
</script>


</body>
</html>