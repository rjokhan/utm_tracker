{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>All projects — Qizil pomada</title>

  <link rel="stylesheet" href="{% static 'css/projects.css' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800;900&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <a href="{% url 'index' %}">
        <img src="{% static 'img/brand-logo.png' %}" alt="Qizil pomada" />
      </a>
    </div>

    <div class="side-actions">
      <button class="action" id="btnCreateProject" data-open-create-project>
        <span>Create<br>New Project</span>
        <i>+</i>
      </button>
    </div>

    <nav class="nav">
      <a class="nav-item" href="{% url 'index' %}">
        <img src="{% static 'img/ic-dashboard.png' %}" alt="">
        <span>Dashboard</span>
      </a>
      <a class="nav-item active" href="{% url 'projects' %}">
        <img src="{% static 'img/ic-projects.png' %}" alt="">
        <span>All projects</span>
      </a>
      <a class="nav-item" href="{% url 'members' %}">
        <img src="{% static 'img/ic-team.png' %}" alt="">
        <span>Team members</span>
      </a>
    </nav>

    <div class="powered">
      <div class="powered-text">Designed &amp; powered by</div>
      <img class="powered-logo" src="{% static 'img/joan-logo.png' %}" alt="JOAN">
    </div>
  </aside>

  <!-- Content -->
  <main class="content">
    <header class="header">
      <div>
        <h1 class="title">All projects</h1>
        <div class="status">Role: <b>Editor</b></div>
      </div>
    </header>

    <section class="projects" id="projects-list">
      <!-- JS заполнит карточки проектов -->
    </section>
  </main>

  <!-- Overlay + Modal -->
  <div id="overlay" class="overlay"></div>

  <div id="create-project-modal" class="modal">
    <h3 class="modal-title">ENTER NAME OF PROJECT</h3>
    <form id="create-project-form">
      <input name="name" class="field" placeholder="Project name" autocomplete="off" required>

      <h3 class="modal-title small">ENTER ACTIVE DATES</h3>
      <div class="grid-2">
        <div>
          <div class="hint">from</div>
          <input name="from" class="field" type="date">
        </div>
        <div>
          <div class="hint">to</div>
          <input name="to" class="field" type="date">
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn" type="submit">CREATE</button>
        <button class="btn ghost" type="button" data-close>Cancel</button>
      </div>
    </form>
  </div>

  <!-- Corner alerts -->
  <div id="corner" class="corner"></div>
<script>
(() => {
  const $  = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

  const overlay = $('#overlay');
  const modal   = $('#create-project-modal');
  const openers = $$('[data-open-create-project], #btnCreateProject');
  const closers = $$('[data-close]');
  const form    = $('#create-project-form');

  // Функции открытия/закрытия
  const openModal = () => {
    modal.classList.add('open');
    overlay.classList.add('open');
    document.body.classList.add('modal-open');
    // Фокус на первое поле
    const first = modal.querySelector('input,button,textarea,select');
    first && first.focus();
  };

  const closeModal = () => {
    modal.classList.remove('open');
    overlay.classList.remove('open');
    document.body.classList.remove('modal-open');
  };

  // Навешиваем события
  openers.forEach(btn => btn.addEventListener('click', (e) => {
    e.preventDefault();
    openModal();
  }));

  closers.forEach(btn => btn.addEventListener('click', (e) => {
    e.preventDefault();
    closeModal();
  }));

  overlay.addEventListener('click', closeModal);

  // Закрытие по Esc
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal.classList.contains('open')) {
      closeModal();
    }
  });

  // Заглушка на submit (поменяйте под свою API-логику)
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(form);
    const payload = {
      name: fd.get('name')?.trim(),
      from: fd.get('from') || null,
      to:   fd.get('to')   || null,
    };

    if (!payload.name) {
      alert('Введите название проекта');
      return;
    }

    // TODO: отправка на ваш backend
    // await fetch('/api/projects/', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) });

    // Временный UX: закрыть модал и показать уголок-уведомление, если он есть
    closeModal();
    const corner = $('#corner');
    if (corner) {
      corner.innerHTML = `<div class="toast ok">Project “${payload.name}” created</div>`;
      corner.classList.add('show');
      setTimeout(() => corner.classList.remove('show'), 2500);
    }
    form.reset();
  });
})();
</script>

  <!-- JS -->
  <script src="{% static 'js/api.js' %}"></script>
  <script src="{% static 'js/projects.js' %}"></script>
</body>
</html>
