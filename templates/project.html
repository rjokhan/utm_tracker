{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project — Qizil pomada</title>

  <!-- CSRF meta (чтобы гарантированно выставлялась cookie) -->
  <meta name="csrf-token" content="{{ csrf_token }}">

  <link rel="stylesheet" href="{% static 'css/project.css' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Mobile rail + burger -->
<div class="m-rail" id="mRail">
  <button class="m-burger" id="mBurger" aria-label="Open menu">
    <img src="{% static 'img/burger_menu.png' %}" alt="">
  </button>
</div>
<div class="m-backdrop" id="mBackdrop"></div>


  <!-- Скрытая форма, чтобы Django выдал csrftoken cookie -->
  <form style="display:none">{% csrf_token %}</form>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <a href="{% url 'index' %}">
        <img src="{% static 'img/brand-logo.png' %}" alt="Qizil pomada" />
      </a>
    </div>

    <div class="side-actions">
      <button class="action" id="btnCreateLink" type="button" aria-haspopup="dialog" aria-controls="modalLink">
        <span>Create<br>New Link</span>
        <i>+</i>
      </button>
      <button class="action" id="btnAddMember" type="button" aria-haspopup="dialog" aria-controls="modalAddMember">
        <span>Add Member</span>
        <i>+</i>
      </button>
    </div>

    <nav class="nav">
      <a class="nav-item" href="{% url 'index' %}">
        <img src="{% static 'img/ic-dashboard.png' %}" alt="">
        <span>Dashboard</span>
      </a>
      <a class="nav-item" href="{% url 'projects' %}">
        <img src="{% static 'img/ic-projects.png' %}" alt="">
        <span>All projects</span>
      </a>
      <a class="nav-item" href="{% url 'members' %}">
        <img src="{% static 'img/ic-team.png' %}" alt="">
        <span>Team members</span>
      </a>
    </nav>

    <div class="powered">
      <div class="powered-text">Designed &amp; powered by</div>
      <img class="powered-logo" src="{% static 'img/joan-logo.png' %}" alt="JOAN">
    </div>
  </aside>

  <!-- Content -->
  <main class="content">
    <header class="header">
      <div class="project-badge">
        <div class="project-name" id="projectName"></div>
        <div class="project-dates" id="projectDates"></div>
        <div class="status">Role: <b>Editor</b></div>
      </div>
    </header>

    <!-- Overview -->
    <section class="section">
      <h3 class="section-title">Overview</h3>

      <div class="kpi-row">
        <div class="kpi kpi-pink">
          <div class="kpi-icon"><img src="{% static 'img/ic-chart.png' %}" alt=""></div>
          <div class="kpi-main">
            <div class="kpi-num" id="kpiMembers"></div>
            <div class="kpi-sub">total members in project</div>
          </div>
        </div>

        <div class="kpi kpi-blue">
          <div class="kpi-icon"><img src="{% static 'img/ic-chart.png' %}" alt=""></div>
          <div class="kpi-main">
            <div class="kpi-num" id="kpiLinks"></div>
            <div class="kpi-sub">total number of links</div>
          </div>
        </div>

        <!-- NEW: Unique users in this project -->
        <div class="kpi kpi-violet">
          <div class="kpi-icon"><img src="{% static 'img/ic-chart.png' %}" alt=""></div>
          <div class="kpi-main">
            <div class="kpi-num" id="kpiUniques"></div>
            <div class="kpi-sub">unique users (project)</div>
          </div>
        </div>

        <div class="kpi kpi-green kpi-wide">
          <div class="kpi-icon"><img src="{% static 'img/ic-chart.png' %}" alt=""></div>
          <div class="kpi-main">
            <div class="kpi-num big" id="kpiClicks"></div>
            <div class="kpi-sub">total number of clicks</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Leads -->
    <section class="section">
      <h3 class="section-title">Leads</h3>
      <div class="podium" id="podium"></div>
      <div class="others" id="others"></div>
    </section>
  </main>

  <!-- Overlay (единый для всех модалок) -->
  <div id="overlay" class="overlay" aria-hidden="true"></div>

  <!-- Create Link -->
  <div id="modalLink" class="modal modal-pink" role="dialog" aria-modal="true" aria-labelledby="modalLinkTitle" aria-describedby="modalLinkDesc">
    <h3 class="modal-title" id="modalLinkTitle">ENTER NAME OF LINK</h3>
    <p id="modalLinkDesc" class="sr-only">Create new tracking link for the selected project</p>

    <input id="linkName" class="field" placeholder="Link name" autocomplete="off">

    <h3 class="modal-title small">ENTER LINK</h3>
    <input id="linkUrl" class="field" placeholder="https://..." inputmode="url" autocomplete="off">

    <h3 class="modal-title small">CHOOSE LINK OWNER</h3>
    <div class="select">
      <input id="linkOwner" class="field select-input" readonly placeholder="Choose member">
      <img class="caret" src="{% static 'img/ic-caret.png' %}" alt="">
      <div class="select-menu" id="ownerMenu"></div>
    </div>

    <div class="modal-actions">
      <button class="btn" id="createLinkBtn" type="button">CREATE</button>
      <button class="btn ghost" type="button" data-close>Cancel</button>
    </div>
  </div>

  <!-- Add Member to project -->
  <div id="modalAddMember" class="modal modal-pink" role="dialog" aria-modal="true" aria-labelledby="modalAddMemberTitle">
    <h3 class="modal-title" id="modalAddMemberTitle">CHOOSE MEMBER TO ADD</h3>

    <div class="select">
      <input id="addMemberInput" class="field select-input" readonly placeholder="Select member">
      <img class="caret" src="{% static 'img/ic-caret.png' %}" alt="">
      <div class="select-menu" id="addMemberMenu"></div>
    </div>

    <div class="modal-actions">
      <button class="btn" id="addMemberBtn" type="button">CREATE</button>
      <button class="btn ghost" type="button" data-close>Cancel</button>
    </div>
  </div>

  <!-- Links of member -->
  <div id="modalLinksList" class="modal modal-white" role="dialog" aria-modal="true" aria-labelledby="linksListTitle">
    <h3 class="modal-title dark" id="linksListTitle">Links</h3>
    <div id="linksListBody" class="links-list"></div>
    <div class="modal-actions">
      <button class="btn ghost dark" type="button" data-close>Close</button>
    </div>
  </div>

  <!-- Corner alerts -->
  <div id="corner" class="corner" aria-live="polite" aria-atomic="true"></div>

  <!-- JS -->
  <script src="{% static 'js/api.js' %}"></script>
  <script src="{% static 'js/project.js' %}"></script>
  <script>
  (function(){
    const body = document.body;
    const burger = document.getElementById('mBurger');
    const backdrop = document.getElementById('mBackdrop');
    const sidebar = document.querySelector('.sidebar');

    const toggle = () => body.classList.toggle('mnav-open');
    const close  = () => body.classList.remove('mnav-open');

    burger?.addEventListener('click', toggle);
    backdrop?.addEventListener('click', close);
    document.addEventListener('keydown', e => { if(e.key==='Escape') close(); });
    sidebar?.addEventListener('click', e => { if(e.target.closest('a')) close(); });
  })();
</script>

</body>
</html>
